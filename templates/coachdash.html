<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{.WebsiteTitle}}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #f5f5f5;
            margin: 0;
        }
        header {
            background-color: #1f1f1f;
            padding: 20px;
            text-align: center;
        }
        main {
            padding: 40px;
            text-align: center;
        }
        .dashboard {
            background-color: #2c2c2c;
            padding: 30px;
            border-radius: 10px;
            max-width: 700px;
            margin: auto;
        }
        .dashboard h2 {
            margin-bottom: 20px;
        }
        select {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            border: 1px solid #444;
            background-color: #1e1e1e;
            color: #f5f5f5;
            border-radius: 5px;
        }
        .user-info {
            margin-top: 20px;
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            text-align: left;
        }
        .user-info p {
            margin: 5px 0;
        }
        button {
            padding: 10px 16px;
            background-color: #b482d4;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 20px;
            cursor: pointer;
        }
        button:hover {
            background-color: #9f6ec2;
        }
        .logout {
            display: inline-block;
            margin-top: 30px;
            padding: 10px 20px;
            background-color: #ff4d4d;
            color: #fff;
            border-radius: 5px;
            text-decoration: none;
        }
        .logout:hover {
            background-color: #e60000;
        }
    </style>
</head>
<body>
    <header>
        <h1>{{.HomePageHeading}}</h1>
    </header>
    <main>
        <div class="dashboard">
            <h2>{{.WelcomeMessage}}</h2>
            <p>This is your Coach Dashboard. You can manage members, assign workout plans, and chat with members.</p>
             
            <h2>Registered Users</h2>
            <select id="userDropdown" onchange="displayUserInfo()">
                <option value="">Select a user</option>
                <!-- User options will be dynamically added here -->
            </select>

            <!-- User Info Section -->
            <div id="userInfo" class="user-info" style="display: none;">
                <h3>User Information</h3>
                <p><strong>Full Name:</strong> <span id="userFullName"></span></p>
                <p><strong>Age:</strong> <span id="userAge"></span></p>
                <p><strong>Gender:</strong> <span id="userGender"></span></p>
                <p><strong>Height:</strong> <span id="userHeight"></span> cm</p>
                <p><strong>Weight:</strong> <span id="userWeight"></span> kg</p>
                <button id="chatButton" onclick="redirectToChat()" style="display: none;">Chat with Member</button>
            </div>

            <a class="logout" href="/logout">Logout</a>
        </div>
    </main>
     
    <script>
        let users = []; // Store all users globally
        let selectedUser = null; // Track the selected user

        // Fetch all user info and populate the dropdown
        async function fetchAllUserInfo() {
            try {
                const response = await fetch("/all-user-info");
                if (!response.ok) {
                    throw new Error("Failed to fetch user info");
                }
                users = await response.json(); // Store users globally
                console.log("Fetched users:", users); // Debug log
                const userDropdown = document.getElementById("userDropdown");

                userDropdown.innerHTML = '<option value="">Select a user</option>'; // Clear existing options
                users.forEach(user => {
                    const option = document.createElement("option");
                    option.value = user.FullName; // Use the correct key
                    option.textContent = user.FullName; // Use the correct key
                    userDropdown.appendChild(option);
                });

                // Add event listener for dropdown change
                userDropdown.addEventListener("change", displayUserInfo);
            } catch (error) {
                console.error("Error fetching user info:", error);
            }
        }

        // Display selected user's information
        function displayUserInfo() {
            const selectedUserName = document.getElementById("userDropdown").value;
            const userInfoDiv = document.getElementById("userInfo");
            const chatButton = document.getElementById("chatButton");

            if (!selectedUserName) {
                userInfoDiv.style.display = "none"; // Hide user info if no user is selected
                chatButton.style.display = "none"; // Hide chat button
                selectedUser = null;
                return;
            }

            // Find the selected user from the users array
            selectedUser = users.find(user => user.FullName === selectedUserName);

            if (selectedUser) {
                document.getElementById("userFullName").textContent = selectedUser.FullName;
                document.getElementById("userAge").textContent = selectedUser.Age;
                document.getElementById("userGender").textContent = selectedUser.Gender;
                document.getElementById("userHeight").textContent = selectedUser.Height;
                document.getElementById("userWeight").textContent = selectedUser.Weight;

                userInfoDiv.style.display = "block"; // Show user info
                chatButton.style.display = "block"; // Show chat button
            }
        }

        // Redirect to the chat page
        function redirectToChat() {
            if (!selectedUser) {
                alert("Please select a user to chat with.");
                return;
            }
            const chatUrl = `/coachchat?user=${encodeURIComponent(selectedUser.FullName)}`;
            window.location.href = chatUrl;
        }

        // Call the function on page load
        window.onload = fetchAllUserInfo;
    </script>
</body>
</html>