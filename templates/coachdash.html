<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{.WebsiteTitle}}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #f5f5f5;
            margin: 0;
        }
        header {
            background-color: #1f1f1f;
            padding: 20px;
            text-align: center;
        }
        main {
            padding: 40px;
            text-align: center;
        }
        .dashboard {
            background-color: #2c2c2c;
            padding: 30px;
            border-radius: 10px;
            max-width: 700px;
            margin: auto;
        }
        .dashboard h2 {
            margin-bottom: 20px;
        }
        .chat-container {
            margin-top: 30px;
            background: #222;
            padding: 20px;
            border-radius: 10px;
        }
        .chat-container h3 {
            margin-bottom: 10px;
        }
        .chat-box {
            height: 200px;
            overflow-y: auto;
            background: #111;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            margin-bottom: 10px;
            text-align: left;
        }
        .chat-box p {
            margin: 5px 0;
            color: #e0e0e0;
        }
        input[type="text"] {
            width: 75%;
            padding: 10px;
            border: 1px solid #444;
            background-color: #1e1e1e;
            color: #f5f5f5;
            border-radius: 5px;
        }
        button {
            padding: 10px 16px;
            background-color: #b482d4;
            color: white;
            border: none;
            border-radius: 5px;
            margin-left: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #9f6ec2;
        }
        .logout {
            display: inline-block;
            margin-top: 30px;
            padding: 10px 20px;
            background-color: #ff4d4d;
            color: #fff;
            border-radius: 5px;
            text-decoration: none;
        }
        .logout:hover {
            background-color: #e60000;
        }
    </style>
</head>
<body>
    <header>
        <h1>{{.HomePageHeading}}</h1>
    </header>       
    <main>
        <div class="dashboard">
            <h2>{{.WelcomeMessage}}</h2>
            <p>This is your Coach Dashboard. You can manage members, assign workout plans, and monitor progress.</p>

            <div class="chat-container">
                <h3>üí¨ Chat with Member</h3>
                <div id="chatBox" class="chat-box"></div>
                <input type="text" id="receiver" placeholder="Enter receiver username..." />
                <input type="text" id="msgInput" placeholder="Type your message..." />
                <button onclick="sendMessage()">Send</button>
            </div>

            <a class="logout" href="/logout">Logout</a>
        </div>
    </main>

    <script>
        const chatBox = document.getElementById("chatBox");
const msgInput = document.getElementById("msgInput");
const receiverInput = document.getElementById("receiver");

let ws;

function connectWebSocket() {
  ws = new WebSocket("ws://localhost:8080/coachdash");

  ws.onopen = () => {
    console.log("‚úÖ Connected to WebSocket server");
  };

  ws.onmessage = function (event) {
    try {
      const msg = JSON.parse(event.data);
      const p = document.createElement("p");
      p.textContent = `From ${msg.sender || "User"}: ${msg.content}`;
      chatBox.appendChild(p);
      chatBox.scrollTop = chatBox.scrollHeight;
    } catch (e) {
      console.error("Invalid message format:", event.data);
    }
  };

  ws.onerror = function (error) {
    console.error("WebSocket error:", error);
  };

  ws.onclose = function (event) {
    console.warn(`‚ö†Ô∏è WebSocket closed: ${event.reason} (code ${event.code})`);
    setTimeout(connectWebSocket, 3000);  // Auto-reconnect after 3 seconds
  };
}

connectWebSocket();

        function sendMessage() {
            const input = document.getElementById("msgInput");
            const receiver = document.getElementById("receiver").value.trim();
            const content = input.value.trim();
            if (receiver !== "" && content !== "") {
                const message = {
                    receiver: receiver,
                    content: content
                };
                ws.send(JSON.stringify(message));
                input.value = "";
            }
        }
    </script>
</body>
</html>
