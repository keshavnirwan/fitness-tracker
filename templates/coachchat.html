<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>coachchat</title>
  <style>
    /* Base Styles */
    body {
  background-color: #111;
  color: #f5f5f5;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  transition: background-color 0.3s, color 0.3s;
}
.dashboard {
  width: 92%;
  padding: 40px 60px;
  background-color: #1e1e1e;
  margin: 0 auto;
  border-radius: 10px;
}
h2, h3, h4 {
  text-align: center;
  margin-bottom: 20px;
}
.back-to-dashboard {
  text-align: center;
  margin-top: 20px;
}

.back-to-dashboard button {
  background-color: #007bff; /* Blue background */
  color: white; /* White text */
  padding: 10px 20px; /* Padding for the button */
  border: none; /* Remove border */
  border-radius: 6px; /* Rounded corners */
  font-size: 1em; /* Font size */
  cursor: pointer; /* Pointer cursor on hover */
  transition: background-color 0.3s ease; /* Smooth transition for hover effect */
}

.back-to-dashboard button:hover {
  background-color: #0056b3; /* Darker blue on hover */
}

.logout {
  text-align: center;
  margin-top: 30px;
}
.logout a, .logout button {
  background-color: #b60a0a;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-size: 1em;
  cursor: pointer;
}
.logout a:hover, .logout button:hover {
  background-color: #640404;
}

/* Chat Section */
.chat-container {
  margin-top: 30px;
  background: #222;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
}
.chat-container h3 {
  font-size: 1.5em;
  margin-bottom: 20px;
  color: #b482d4;
}
.chat-box {
  height: 280px;
  overflow-y: auto;
  background: #111;
  padding: 15px;
  border: 1px solid #333;
  border-radius: 8px;
  margin-bottom: 20px;
  scroll-behavior: smooth;
  font-size: 0.95em;
}
.chat-box p {
  margin: 8px 0;
  padding: 8px 12px;
  background-color: #2e2e2e;
  border-radius: 6px;
  line-height: 1.4em;
  color: #e0e0e0;
  max-width: 90%;
  word-wrap: break-word;
}
.chat-box p:nth-child(odd) {
  background-color: #1f1f1f;
}
.chat-inputs {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}
.chat-inputs input[type="text"] {
  padding: 10px;
  border: 1px solid #444;
  background-color: #1e1e1e;
  color: #f5f5f5;
  border-radius: 5px;
  flex: 1 1 200px;
}
.chat-inputs #receiver {
  max-width: 220px;
}
.chat-inputs button {
  padding: 10px 16px;
  background-color: #b482d4;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  flex-shrink: 0;
}
.chat-inputs button:hover {
  background-color: #9f6ec2;
}

/* Responsive */
@media (max-width: 600px) {
  .chat-inputs {
    flex-direction: column;
    align-items: stretch;
  }
  .chat-inputs input, .chat-inputs button {
    width: 100%;
  }
}

/* Light Mode */
body.dark {
  background-color: #f5f5f5;
  color: #111;
}
body.dark .dashboard {
  background-color: #e0e0e0;
  color: #111;
}
body.dark .chat-box {
  background-color: #fff;
  color: #111;
  border: 1px solid #ccc;
}
body.dark .chat-box p {
  background-color: #f0f0f0;
  color: #222;
}
body.dark .chat-box p:nth-child(odd) {
  background-color: #e4e4e4;
}
body.dark .chat-container h3 {
  color: #673ab7;
}
  </style>
</head>
<body>
  <div class="dashboard">
     
    <h2>Welcome Coach</h2>
    {{if .Message}}
      <div class="success-message">{{.Message}}</div>
    {{end}}
 
  
    <div class="chat-container">
        <h3>ðŸ’¬ Chat with Member</h3>
        <div id="chatBox" class="chat-box"></div>
        <div class="chat-inputs">
          <input type="text" id="receiver" placeholder="User username..." />
          <button onclick="fetchChatHistory()">Load Chat</button>
          <input type="text" id="msgInput" placeholder="Type your message..." />
          <button onclick="sendMessage()">Send</button>
        </div>

        
    <div class="back-to-dashboard">
        <button onclick="location.href='/home'">Back to Dashboard</button>
      </div>

    <div class="logout">
      <button onclick="location.href='/logout'">Logout</button>
    </div>
  </div>

  <script>
     
     const chatBox = document.getElementById("chatBox");
        const msgInput = document.getElementById("msgInput");
        const receiverInput = document.getElementById("receiver");
      
        let ws = new WebSocket("ws://localhost:8080/ws");
      
        ws.onmessage = function (event) {
          const msg = JSON.parse(event.data);
          const p = document.createElement("p");
          p.textContent = `From ${msg.sender}: ${msg.content}`;
          chatBox.appendChild(p);
          chatBox.scrollTop = chatBox.scrollHeight;
        };
      
        async function fetchChatHistory() {
  const receiver = receiverInput.value.trim();
  if (!receiver) {
    alert("Please enter the coach's username to load chat history.");
    return;
  }

  try {
    const response = await fetch(`/chat-history?receiver=${receiver}`);
    if (!response.ok) {
      throw new Error("Failed to fetch chat history");
    }
    const messages = await response.json();
    chatBox.innerHTML = ""; // Clear existing messages

    if (!messages || messages.length === 0) {
      const p = document.createElement("p");
      p.textContent = "No messages found.";
      chatBox.appendChild(p);
      return;
    }

    messages.forEach(msg => {
      const p = document.createElement("p");
      p.textContent = `${msg.Sender}: ${msg.Content} (${msg.Time})`;
      chatBox.appendChild(p);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  } catch (error) {
    console.error("Error fetching chat history:", error);
  }
}

function sendMessage() {
          const content = msgInput.value.trim();
          const receiver = receiverInput.value.trim();
          if (receiver && content) {
            const message = { receiver: receiver, content: content };
            ws.send(JSON.stringify(message));
            msgInput.value = "";
          }
        }






  // Fetch all user info and populate the table
  async function fetchAllUserInfo() {
    try {
        const response = await fetch("/all-user-info");
        if (!response.ok) {
            throw new Error("Failed to fetch user info");
        }
        const users = await response.json();
        console.log("Fetched users:", users); // Debug log
        const userDropdown = document.getElementById("userDropdown");

        userDropdown.innerHTML = '<option value="">Select a user</option>'; // Clear existing options
        users.forEach(user => {
            const option = document.createElement("option");
            option.value = user.FullName; // Use the correct key
            option.textContent = user.FullName; // Use the correct key
            userDropdown.appendChild(option);
        });
    } catch (error) {
        console.error("Error fetching user info:", error);
    }
}

// Call the function on page load
window.onload = fetchAllUserInfo;

  </script>
</body>
</html>
